# Syslog Server Configuration with Multi-Party Threshold TLS
# RFC 5425 - TLS Transport for Syslog
# Private key protected by (3,5)-threshold Shamir's Secret Sharing

# Load modules
module(load="imtcp")
module(load="imuxsock")

# TLS driver settings - USING MULTI-PARTY THRESHOLD KEY
$DefaultNetstreamDriver gtls
$DefaultNetstreamDriverCAFile /mnt/c/Users/kumarrishabh/Documents/WNS/syslog_certs/ca-cert.pem
$DefaultNetstreamDriverCertFile /mnt/c/Users/kumarrishabh/Documents/WNS/syslog_certs/server-cert.pem
$DefaultNetstreamDriverKeyFile /mnt/c/Users/kumarrishabh/Documents/WNS/syslog_certs/server-key.pem
$InputTCPServerStreamDriverAuthMode x509/name
$InputTCPServerStreamDriverPermittedPeer amf2-client
$InputTCPServerStreamDriverMode 1 # TLS mode

# Listen on TLS port
$ModLoad imtcp
$InputTCPServerRun 6514

# Template for AMF logs
$template AMF2Template,"/var/log/amf2/%HOSTNAME%-%$YEAR%%$MONTH%%$DAY%.log"

# Log AMF-2 messages
if $fromhost-ip == '192.168.71.136' then ?AMF2Template
& stop

# Default logging
*.info;mail.none;authpriv.none;cron.none    /var/log/messages
