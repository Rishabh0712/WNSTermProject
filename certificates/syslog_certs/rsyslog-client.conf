# AMF-2 Rsyslog Client Configuration
# Connects to server using multi-party threshold TLS

# Load modules
module(load="imuxsock")
module(load="imklog")
module(load="omfwd")

# TLS driver settings
$DefaultNetstreamDriver gtls
$DefaultNetstreamDriverCAFile /etc/rsyslog.d/certs/ca-cert.pem
$DefaultNetstreamDriverCertFile /etc/rsyslog.d/certs/client-cert.pem
$DefaultNetstreamDriverKeyFile /etc/rsyslog.d/certs/client-key.pem
$ActionSendStreamDriverAuthMode x509/name
$ActionSendStreamDriverPermittedPeer syslog-server
$ActionSendStreamDriverMode 1 # TLS mode

# Forward all logs to secure syslog server
*.* @@(o)HOST_IP:6514

# Local logging
*.info;mail.none;authpriv.none;cron.none    /var/log/messages
authpriv.*                                   /var/log/secure
